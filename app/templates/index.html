{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-semibold mb-6 text-gray-800">Analyze a Candidate</h2>

        <form id="analysisForm" method="POST" action="/analyze">
            <!-- GitHub Username -->
            <div class="mb-6">
                <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
                    GitHub Username *
                </label>
                <input
                    type="text"
                    id="username"
                    name="username"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="octocat"
                >
                <p class="mt-1 text-xs text-gray-500">
                    Enter the GitHub username to analyze
                </p>
            </div>

            <!-- Job Description -->
            <div class="mb-6">
                <label for="job_description" class="block text-sm font-medium text-gray-700 mb-2">
                    Job Description * (minimum 50 characters)
                </label>
                <textarea
                    id="job_description"
                    name="job_description"
                    required
                    minlength="50"
                    rows="8"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Senior Full-Stack Engineer. Required: React, TypeScript, Node.js, PostgreSQL. Responsibilities include..."
                ></textarea>
                <p class="mt-1 text-xs text-gray-500">
                    Paste the full job description with requirements and technologies
                </p>
            </div>

            <!-- Additional Context -->
            <div class="mb-6">
                <label for="additional_context" class="block text-sm font-medium text-gray-700 mb-2">
                    Additional Context (optional)
                </label>
                <textarea
                    id="additional_context"
                    name="additional_context"
                    rows="4"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Focus on backend skills, check for fintech experience, ignore side projects..."
                ></textarea>
                <p class="mt-1 text-xs text-gray-500">
                    Add any special requests or areas of focus for the analysis
                </p>
            </div>

            <!-- Submit Button -->
            <button
                type="submit"
                id="submitBtn"
                class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
            >
                Analyze Candidate
            </button>

            <p class="mt-4 text-sm text-gray-600 text-center">
                Analysis takes 5-15 minutes. You'll see progress updates in real-time.
            </p>
        </form>
    </div>

    <!-- Info Box -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="font-semibold text-blue-900 mb-2">What this analyzer does:</h3>
        <ul class="text-sm text-blue-800 space-y-1">
            <li>✓ Fetches and filters candidate's GitHub repositories</li>
            <li>✓ Analyzes recent, relevant projects (past 12 months)</li>
            <li>✓ Clones repos and examines code quality</li>
            <li>✓ Runs tests and quality checks (when possible)</li>
            <li>✓ Generates comprehensive evaluation report</li>
            <li>✓ Provides hire/no-hire recommendation and interview questions</li>
        </ul>
    </div>
</div>

<script>
document.getElementById('analysisForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Starting analysis...';
    submitBtn.classList.add('opacity-75', 'cursor-not-allowed');

    const formData = new FormData(e.target);

    try {
        const response = await fetch('/analyze', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (response.ok) {
            // Redirect to results page
            window.location.href = data.redirect_url;
        } else {
            alert('Error: ' + (data.detail || 'Analysis failed to start'));
            submitBtn.disabled = false;
            submitBtn.textContent = 'Analyze Candidate';
            submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
        }
    } catch (error) {
        alert('Error starting analysis: ' + error.message);
        submitBtn.disabled = false;
        submitBtn.textContent = 'Analyze Candidate';
        submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
    }
});
</script>
{% endblock %}
